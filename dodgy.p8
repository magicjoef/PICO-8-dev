pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	make_player()
	make_enemy_1()
	make_gate()
end

function _update()
	anim_loop_adv()
	player_anim()
	move_player()
	move_enemy_1()
	bounce_enemy_1()
	reach_gate()
	flag_movement()
	detect_col()
end

function _draw()
 cls()
 draw_map()
	draw_player()
	draw_enemy_1()
	draw_gate()
	messages()
	show_debug()
end
-->8
-- player
function make_player()
	player={}
	player.x=63
	player.y=120
	player.w=8
	player.h=8
	player.speed=2
	player.cur_spr=1
	player.is_moving=false
end

function player_anim()
	if player.is_moving==false then
  if anim_loop==0
  	or anim_loop==13 then
   	player.cur_spr=1
  end
  if anim_loop==7
  	or anim_loop==22 then
   	player.cur_spr=2
  end
 else
   if anim_loop==0
   	or anim_loop==13 then
    	player.cur_spr=3
   end
   if anim_loop==7
   	or anim_loop==22 then
    	player.cur_spr=4
   end
 end
end

function move_player()
	if btn(1) then
		if player.x < 120 then
			player.x+=player.speed
		end
	end
	if btn(0) then
		if player.x > 0 then
			player.x-=player.speed
		end
	end
	if btn(2) then
		if player.y > 0 then
			player.y-=player.speed
		end
	end
	if btn(3) then
		if player.y < 120 then
			player.y+=player.speed
		end
	end
end

function flag_movement()
 if btn(0)
 		or btn(1)
 		or btn(2)
 		or btn(3) then
 	player.is_moving=true
 else
 	player.is_moving=false
 end
end

function draw_player()
	 spr(player.cur_spr, player.x, player.y)
end
-->8
--map
function draw_map()
	rectfill(0,0,127,127,5)
	map(0,0,0,0,16,8)
	map(0,0,0,64,16,8)
end
-->8
--game
game_over=false
hits=0
colx=false
coly=false
anim_loop=0

function anim_loop_adv()
 --time to base player animation
 if anim_loop < 29 then
 	anim_loop+=1
 else
 	anim_loop=0
 end
end

function make_gate()
	gate={}
	gate.x=59
	gate.y=0
	gate.width=10
	gate.height=4
end
function draw_gate()
	rectfill(gate.x,
										gate.y,
										gate.x+gate.width,
										gate.y+gate.height,
										4)
end

escaped=false
function reach_gate()
	if player.x>=53
		and player.x<=69
		and player.y<=4 then
			escaped=true
		else
			escaped=false	
	end
end

function messages()
	if escaped then
		print("phew! you made it âŒ‚",22,70,6)
	end
end

function detect_colx()
	if
		player.x>enemy_1.x
		and
		player.x<enemy_1.x+enemy_1.w
	then
		hits+=1
		colx=true
	else
		colx=false
	end
end
function detect_coly()
	if
		player.y>enemy_1.y
		and
		player.y<enemy_1.y+enemy_1.h
	then
		hits+=1
		coly=true
	else
		coly=false
	end
end
function detect_col()
	detect_colx()
	detect_coly()
	if coly==true and colx==true then
		game_over=true
	end
end

function show_debug()
	color(6)
	-- player coords
	print("x:"..player.x,0,0,6)
	print("y:"..player.y,0,6,6)
	-- game loop counter
	print("anim loop:"..anim_loop,0,12,6)
	-- movement flag
	print("moving:"..(player.is_moving and "true" or "false"),0,18,6)
	print("escape:"..(escaped and "true" or "false"),0,24,6)
	print("game_over:"..(game_over and "true" or "false"),0,30,6)
	print("hits:"..hits,0,36,6)
end
-->8
--enemies
function make_enemy_1()
	enemy_1={}
	enemy_1.x=60
	enemy_1.y=30
	enemy_1.w=8
	enemy_1.h=8
	enemy_1.cur_spr=5
	enemy_1.dirx="r"
	enemy_1.diry="d"
	enemy_1.speed="3"
end

function move_enemy_1()
	if enemy_1.dirx=="r" then
		enemy_1.x+=enemy_1.speed
	end
	if enemy_1.dirx=="l" then
		enemy_1.x-=enemy_1.speed
	end
	if enemy_1.diry=="d" then
		enemy_1.y+=enemy_1.speed
	end
	if enemy_1.diry=="u" then
		enemy_1.y-=enemy_1.speed
	end
end
function bounce_enemy_1()
	if enemy_1.dirx=="r" and enemy_1.x>=120 then
		enemy_1.dirx="l"
	end
	if enemy_1.dirx=="l" and enemy_1.x<=0 then
		enemy_1.dirx="r"
	end
	if enemy_1.diry=="d" and enemy_1.y>=120 then
		enemy_1.diry="u"
	end
	if enemy_1.diry=="u" and enemy_1.y<=0 then
		enemy_1.diry="d"
	end
end

function draw_enemy_1()
 spr(enemy_1.cur_spr,enemy_1.x,enemy_1.y)
end
__gfx__
000000000005500000000000000550f00f0550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ff00000055000000ff020020ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000222200000ff000022222200222222000e6660000e66600000000000000000000000000000000000000000000000000000000000000000000000000
00077000020220200022220002022000000220200e6666a60e6666a6000000000000000000000000000000000000000000000000000000000000000000000000
0007700002044020020220200f044000000440f0e0666666e0666666000000000000000000000000000000000000000000000000000000000000000000000000
007007000f0cc0f002044020000ccc0000ccc0000006006000600600000000000000000000000000000000000000000000000000000000000000000000000000
00000000000cc0000f0cc0f0000c0c0000c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000004400000040400004040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
